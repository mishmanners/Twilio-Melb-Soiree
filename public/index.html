<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartoon Gallery - AI Generated Images</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>üé® AI Cartoon Gallery</h1>
        <p>Generated anime-style images from WhatsApp bot</p>
    </div>
    
    <div class="carousel-container">
        <div id="loading" class="loading">
            <p>Loading images...</p>
        </div>
        
        <div id="no-images" class="no-images" style="display: none;">
            <h3>No images found</h3>
            <p>Send a selfie to the WhatsApp bot to generate your first cartoon!</p>
            <button class="refresh-btn" onclick="loadImages()">Refresh</button>
        </div>
        
        <div id="carousel" class="carousel" style="display: none;">
            <button class="carousel-nav prev" id="prevBtn" onclick="changeImage(-1)">‚ùÆ</button>
            <img id="currentImage" src="" alt="Generated cartoon" />
            <button class="carousel-nav next" id="nextBtn" onclick="changeImage(1)">‚ùØ</button>
        </div>
        
        <div id="carousel-info" class="carousel-info" style="display: none;">
            <div class="image-counter" id="imageCounter"></div>
            <div class="image-date" id="imageDate"></div>
        </div>
        
        <div id="dots-container" class="dots-container" style="display: none;"></div>
    </div>
    
    <script>
        let images = [];
        let currentIndex = 0;
        let autoAdvanceInterval = null;
        
        async function loadImages() {
            try {
                const response = await fetch('/api/images');
                images = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                
                if (images.length === 0) {
                    document.getElementById('no-images').style.display = 'block';
                } else {
                    document.getElementById('carousel').style.display = 'flex';
                    document.getElementById('carousel-info').style.display = 'block';
                    document.getElementById('dots-container').style.display = 'block';
                    setupCarousel();
                }
            } catch (error) {
                console.error('Failed to load images:', error);
                document.getElementById('loading').innerHTML = '<p>Failed to load images. Please refresh the page.</p>';
            }
        }
        
        function setupCarousel() {
            createDots();
            showImage(0);
            startAutoAdvance();
        }
        
        function startAutoAdvance() {
            // Clear any existing interval
            if (autoAdvanceInterval) {
                clearInterval(autoAdvanceInterval);
            }
            
            // Only start auto-advance if there are multiple images
            if (images.length > 1) {
                autoAdvanceInterval = setInterval(() => {
                    const nextIndex = (currentIndex + 1) % images.length;
                    showImage(nextIndex);
                }, 5000); // 5 seconds
            }
        }
        
        function stopAutoAdvance() {
            if (autoAdvanceInterval) {
                clearInterval(autoAdvanceInterval);
                autoAdvanceInterval = null;
            }
        }
        
        function createDots() {
            const dotsContainer = document.getElementById('dots-container');
            dotsContainer.innerHTML = '';
            
            images.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.className = 'dot';
                dot.onclick = () => {
                    // Stop auto-advance when user clicks dot
                    stopAutoAdvance();
                    showImage(index);
                    // Restart auto-advance after manual interaction
                    setTimeout(startAutoAdvance, 3000); // Wait 3 seconds before resuming
                };
                dotsContainer.appendChild(dot);
            });
        }
        
        function showImage(index) {
            if (images.length === 0) return;
            
            currentIndex = index;
            const image = images[currentIndex];
            
            document.getElementById('currentImage').src = image.url;
            document.getElementById('imageCounter').textContent = `${currentIndex + 1} of ${images.length}`;
            document.getElementById('imageDate').textContent = new Date(image.created).toLocaleString();
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === images.length - 1;
            
            // Update dots
            document.querySelectorAll('.dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentIndex);
            });
        }
        
        function changeImage(direction) {
            const newIndex = currentIndex + direction;
            if (newIndex >= 0 && newIndex < images.length) {
                // Stop auto-advance when user manually navigates
                stopAutoAdvance();
                showImage(newIndex);
                // Restart auto-advance after manual interaction
                setTimeout(startAutoAdvance, 3000); // Wait 3 seconds before resuming
            }
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') changeImage(-1);
            if (e.key === 'ArrowRight') changeImage(1);
        });
        
        // Pause auto-advance on hover, resume on mouse leave
        document.addEventListener('DOMContentLoaded', () => {
            const carouselContainer = document.querySelector('.carousel-container');
            if (carouselContainer) {
                carouselContainer.addEventListener('mouseenter', stopAutoAdvance);
                carouselContainer.addEventListener('mouseleave', startAutoAdvance);
            }
        });
        
        // Auto-refresh every 30 seconds
        setInterval(loadImages, 30000);
        
        // Load images on page load
        loadImages();
    </script>
</body>
</html>

